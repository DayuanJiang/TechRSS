---
import Layout from '../../layouts/Layout.astro';
import DateNav from '../../components/DateNav.astro';
import ArticleItem from '../../components/ArticleItem.astro';
import { listDigestDates, loadDigest } from '../../lib/data';

export function getStaticPaths() {
  return listDigestDates().map(date => ({ params: { date } }));
}

const { date } = Astro.params;
const digest = loadDigest(date!);
const dates = listDigestDates();
const idx = dates.indexOf(date!);
const prevDate = idx < dates.length - 1 ? dates[idx + 1] : undefined;
const nextDate = idx > 0 ? dates[idx - 1] : undefined;
const articles = digest?.articles || [];
---
<Layout title={`TechDigest — ${date}`}>
  <DateNav date={date!} prevDate={prevDate} nextDate={nextDate} />

  {digest?.highlights && (
    <div class="bg-white border border-gray-200 rounded px-4 py-3 mb-4 text-[0.95em] leading-relaxed">
      <div class="font-bold mb-1 text-hn-orange">今日看点</div>
      {digest.highlights}
    </div>
  )}

  {digest && (
    <div class="text-xs text-gray-400 mb-4">
      扫描 {digest.success_feeds}/{digest.total_feeds} 源 · 获取 {digest.total_articles} 篇 · 精选 {articles.length} 篇
    </div>
  )}

  {articles.length > 0 ? (
    <ol class="list-none p-0">
      {articles.map((article) => (
        <ArticleItem article={article} />
      ))}
    </ol>
  ) : (
    <div class="text-center py-16 text-gray-400"><p>今日暂无文章</p></div>
  )}

  <DateNav date={date!} prevDate={prevDate} nextDate={nextDate} />
</Layout>
