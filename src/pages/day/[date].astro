---
import Layout from '../../layouts/Layout.astro';
import DateNav from '../../components/DateNav.astro';
import ArticleItem from '../../components/ArticleItem.astro';
import { listDigestDates, loadDigest } from '../../lib/data';

export function getStaticPaths() {
  return listDigestDates().map(date => ({ params: { date } }));
}

const { date } = Astro.params;
const digest = loadDigest(date!);
const dates = listDigestDates();
const idx = dates.indexOf(date!);
const prevDate = idx < dates.length - 1 ? dates[idx + 1] : undefined;
const nextDate = idx > 0 ? dates[idx - 1] : undefined;
const articles = digest?.articles || [];
---
<Layout title={`TechDigest — ${date}`}>
  <DateNav date={date!} prevDate={prevDate} nextDate={nextDate} />

{digest && (
    <div class="flex items-center gap-1.5 text-xs text-text-tertiary mb-4">
      <span class="w-1.5 h-1.5 rounded-full bg-green-500 inline-block"></span>
      扫描 {digest.success_feeds}/{digest.total_feeds} 源 · 获取 {digest.total_articles} 篇 · 精选 {articles.length} 篇
    </div>
  )}

  {articles.length > 0 ? (
    <div class="space-y-2">
      {articles.map((article) => (
        <ArticleItem article={article} />
      ))}
    </div>
  ) : (
    <div class="text-center py-16 text-text-tertiary"><p>今日暂无文章</p></div>
  )}

  <DateNav date={date!} prevDate={prevDate} nextDate={nextDate} />
</Layout>
